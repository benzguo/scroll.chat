var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function i(t){return"function"==typeof t}function r(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function s(n,...e){if(null==n)return t;const o=n.subscribe(...e);return o.unsubscribe?()=>o.unsubscribe():o}function a(t,n,e){t.$$.on_destroy.push(s(n,e))}function u(t,n){t.appendChild(n)}function c(t,n,e){t.insertBefore(n,e||null)}function f(t){t.parentNode.removeChild(t)}function l(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function h(){return p(" ")}function d(t,n,e,o){return t.addEventListener(n,e,o),()=>t.removeEventListener(n,e,o)}function g(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function m(t,n){n=""+n,t.data!==n&&(t.data=n)}function v(t,n){(null!=n||t.value)&&(t.value=n)}function b(t,n,e,o){t.style.setProperty(n,e,o?"important":"")}let y;function k(t){y=t}function x(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(t)}const w=[],$=[],_=[],j=[],S=Promise.resolve();let T=!1;function O(t){_.push(t)}let A=!1;const N=new Set;function G(){if(!A){A=!0;do{for(let t=0;t<w.length;t+=1){const n=w[t];k(n),M(n.$$)}for(w.length=0;$.length;)$.pop()();for(let t=0;t<_.length;t+=1){const n=_[t];N.has(n)||(N.add(n),n())}_.length=0}while(w.length);for(;j.length;)j.pop()();T=!1,A=!1,N.clear()}}function M(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(O)}}const I=new Set;function E(t,n){t&&t.i&&(I.delete(t),t.i(n))}const D="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function J(t,n){t.d(1),n.delete(t.key)}function R(t,n,e,o,i,r,s,a,u,c,f,l){let p=t.length,h=r.length,d=p;const g={};for(;d--;)g[t[d].key]=d;const m=[],v=new Map,b=new Map;for(d=h;d--;){const t=l(i,r,d),a=e(t);let u=s.get(a);u?o&&u.p(t,n):(u=c(a,t),u.c()),v.set(a,m[d]=u),a in g&&b.set(a,Math.abs(d-g[a]))}const y=new Set,k=new Set;function x(t){E(t,1),t.m(a,f,s.has(t.key)),s.set(t.key,t),f=t.first,h--}for(;p&&h;){const n=m[h-1],e=t[p-1],o=n.key,i=e.key;n===e?(f=n.first,p--,h--):v.has(i)?!s.has(o)||y.has(o)?x(n):k.has(i)?p--:b.get(o)>b.get(i)?(k.add(o),x(n)):(y.add(i),p--):(u(e,s),p--)}for(;p--;){const n=t[p];v.has(n.key)||u(n,s)}for(;h;)x(m[h-1]);return m}function P(t,n){-1===t.$$.dirty[0]&&(w.push(t),T||(T=!0,S.then(G)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function C(r,s,a,u,c,l,p=[-1]){const h=y;k(r);const d=s.props||{},g=r.$$={fragment:null,ctx:null,props:l,update:t,not_equal:c,bound:e(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(h?h.$$.context:[]),callbacks:e(),dirty:p};let m=!1;if(g.ctx=a?a(r,d,(t,n,...e)=>{const o=e.length?e[0]:n;return g.ctx&&c(g.ctx[t],g.ctx[t]=o)&&(g.bound[t]&&g.bound[t](o),m&&P(r,t)),n}):[],g.update(),m=!0,o(g.before_update),g.fragment=!!u&&u(g.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);g.fragment&&g.fragment.l(t),t.forEach(f)}else g.fragment&&g.fragment.c();s.intro&&E(r.$$.fragment),function(t,e,r){const{fragment:s,on_mount:a,on_destroy:u,after_update:c}=t.$$;s&&s.m(e,r),O(()=>{const e=a.map(n).filter(i);u?u.push(...e):o(e),t.$$.on_mount=[]}),c.forEach(O)}(r,s.target,s.anchor),G()}k(h)}let F;"function"==typeof HTMLElement&&(F=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){for(const t in this.$$.slotted)this.appendChild(this.$$.slotted[t])}attributeChangedCallback(t,n,e){this[t]=e}$destroy(){!function(t,n){const e=t.$$;null!==e.fragment&&(o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}(this,1),this.$destroy=t}$on(t,n){const e=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return e.push(n),()=>{const t=e.indexOf(n);-1!==t&&e.splice(t,1)}}$set(){}});const H=[];function z(n,e=t){let o;const i=[];function s(t){if(r(n,t)&&(n=t,o)){const t=!H.length;for(let t=0;t<i.length;t+=1){const e=i[t];e[1](),H.push(e,n)}if(t){for(let t=0;t<H.length;t+=2)H[t][0](H[t+1]);H.length=0}}}return{set:s,update:function(t){s(t(n))},subscribe:function(r,a=t){const u=[r,a];return i.push(u),1===i.length&&(o=e(s)||t),r(n),()=>{const t=i.indexOf(u);-1!==t&&i.splice(t,1),0===i.length&&(o(),o=null)}}}}function W(n,e,r){const a=!Array.isArray(n),u=a?[n]:n,c=e.length<2;return{subscribe:z(r,n=>{let r=!1;const f=[];let l=0,p=t;const h=()=>{if(l)return;p();const o=e(a?f[0]:f,n);c?n(o):p=i(o)?o:t},d=u.map((t,n)=>s(t,t=>{f[n]=t,l&=~(1<<n),r&&h()},()=>{l|=1<<n}));return r=!0,h(),function(){o(d),p()}}).subscribe}}var q,L=function(t,n){var e="000000000"+t;return e.substr(e.length-n)},B="object"==typeof window?window:self,U=Object.keys(B).length,X=navigator.mimeTypes?navigator.mimeTypes.length:0,K=L((X+navigator.userAgent.length).toString(36)+U.toString(36),4),V=function(){return K},Y="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;if(Y){var Q=Math.pow(2,32)-1;q=function(){return Math.abs(Y.getRandomValues(new Uint32Array(1))[0]/Q)}}else q=Math.random;var Z=q,tt=0,nt=Math.pow(36,4);function et(){return L((Z()*nt<<0).toString(36),4)}function ot(){return tt=tt<nt?tt:0,++tt-1}function it(){return"c"+(new Date).getTime().toString(36)+L(ot().toString(36),4)+V()+(et()+et())}it.slug=function(){var t=(new Date).getTime().toString(36),n=ot().toString(36).slice(-4),e=V().slice(0,1)+V().slice(-1),o=et().slice(-2);return t.slice(-2)+n+e+o},it.isCuid=function(t){return"string"==typeof t&&!!t.startsWith("c")},it.isSlug=function(t){if("string"!=typeof t)return!1;var n=t.length;return n>=7&&n<=10},it.fingerprint=V;var rt=it;const st=function(){const t=JSON.parse(sessionStorage.getItem("chat_user"))||rt(),{subscribe:n,update:e,set:o}=z(t);return n(t=>{sessionStorage.setItem("chat_user",JSON.stringify(t))}),{subscribe:n,update:e,set:o}}();var at="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var ut=function(t,n){return t(n={exports:{}},n.exports),n.exports}((function(t){!function(){var n;"undefined"!=typeof window&&(n=window),void 0!==at&&(n=at);var e=(n=n||{}).console||{log:function(){}};function o(t,n){return n?function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}():t.slice?o[e(t)]:function(n,i){t(n={exports:{}}),o[e(i)]=n.exports};function e(t){return t.split("/").slice(-1).toString().replace(".js","")}}var i=t;o((function(t){var n={fn:{is:function(t){return!!t&&"function"==typeof t}}};n.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},n.num={is:function(t){return!o(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},n.text={is:function(t){return"string"==typeof t}},n.text.ify=function(t){return n.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},n.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},n.text.match=function(t,n){var e,o;return"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(e=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>n[">"]&&t<n["<"]:o!==n[">"]&&t>n[">"]||o!==n["<"]&&t<n["<"])))},n.list={is:function(t){return t instanceof Array}},n.list.slit=Array.prototype.slice,n.list.sort=function(t){return function(n,e){return n&&e?(n=n[t])<(e=e[t])?-1:n>e?1:0:0}},n.list.map=function(t,n,e){return a(t,n,e)},n.list.index=1,n.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=function(t,n,e){return(t||{})[n]=e,t},n.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},n.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},n.obj.ify=function(t){if(r(t))return t;try{t=JSON.parse(t)}catch(n){t={}}return t},function(){function t(t,n){s(this,n)&&void 0!==this[n]||(this[n]=t)}n.obj.to=function(n,e){return a(n,t,e=e||{}),e}}(),n.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function t(t,n){var e=this.n;if(!e||!(n===e||r(e)&&s(e,n)))return!!n||void 0}n.obj.empty=function(n,e){return!n||!a(n,t,{n:e})}}(),function(){function t(n,e){if(2===arguments.length)return t.r=t.r||{},void(t.r[n]=e);t.r=t.r||[],t.r.push(n)}var i=Object.keys;n.obj.map=function(a,u,c){var f,l,p,h,d,g=0,m=e(u);if(t.r=null,i&&r(a)&&(h=i(a),d=!0),o(a)||h)for(l=(h||a).length;g<l;g++){var v=g+n.list.index;if(m){if((p=d?u.call(c||this,a[h[g]],h[g],t):u.call(c||this,a[g],v,t))!==f)return p}else if(u===a[d?h[g]:g])return h?h[g]:v}else for(g in a)if(m){if(s(a,g)&&(p=c?u.call(c,a[g],g,t):u(a[g],g,t))!==f)return p}else if(u===a[g])return g;return m?t.r:n.list.index?0:-1}}(),n.time={},n.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};var e=n.fn.is,o=n.list.is,i=n.obj,r=i.is,s=i.has,a=i.map;t.exports=n}))(o,"./type"),o((function(t){t.exports=function t(n,e,o){if(!n)return{to:t};n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(e instanceof Function){var i={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(i.back=n.last||n).to=i,n.last=i}return(n=n.to)&&void 0!==e&&n.next(e),n}}))(o,"./onto"),o((function(t){if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var n=JSON.stringify;t.exports=function(t,e,o,i,r){if(t<e)return{defer:!0};if(e<o)return{historical:!0};if(o<e)return{converge:!0,incoming:!0};if(e===o){if((i=n(i)||"")===(r=n(r)||""))return{state:!0};if(i<r)return{converge:!0,current:!0};if(r<i)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+i+" to "+r+" at "+e+" to "+o+"!"}}}))(o,"./HAM"),o((function(t){var n=o("./type"),e={is:function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(a(t)||r(t)||s(t))||(e.link.is(t)||!1)))}};e.link=e.rel={_:"#"},function(){function t(t,n){var e=this;return e.id?e.id=!1:n==i&&a(t)?void(e.id=t):e.id=!1}e.link.is=function(n){if(n&&n[i]&&!n._&&c(n)){var e={};if(l(n,t,e),e.id)return e.id}return!1}}(),e.link.ify=function(t){return f({},i,t)},n.obj.has._=".";var i=e.link._,r=n.bi.is,s=n.num.is,a=n.text.is,u=n.obj,c=u.is,f=u.put,l=u.map;t.exports=e}))(o,"./val"),o((function(t){var n=o("./type"),e=o("./val"),i={_:"_",soul:function(t,n){return t&&t._&&t._[n||f]}};i.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[f]=n.soul||t._[f]||c(),t},i.soul._=e.link._,function(){function t(t,n){if(n!==i._)return!e.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}i.is=function(n,e,o){var r;return!!s(n)&&(!!(r=i.soul(n))&&!u(n,t,{as:o,cb:e,s:r,n:n}))}}(),function(){function t(t,n){var o,i=this.o;i.map?void 0===(o=i.map.call(this.as,t,""+n,i.node))?a(i.node,n):i.node&&(i.node[n]=o):e.is(t)&&(i.node[n]=t)}i.ify=function(n,e,o){return e?"string"==typeof e?e={soul:e}:e instanceof Function&&(e={map:e}):e={},e.map&&(e.node=e.map.call(o,n,void 0,e.node||{})),(e.node=i.soul.ify(e.node||{},e))&&u(n,t,{o:e,as:o}),e.node}}();var r=n.obj,s=r.is,a=r.del,u=r.map,c=n.text.random,f=i.soul._;t.exports=i}))(o,"./node"),o((function(t){var n=o("./type"),e=o("./node");function i(){var t;return t=r(),s<t?(a=0,s=t+i.drift):s=t+(a+=1)/u+i.drift}var r=n.time.is,s=-1/0,a=0,u=1e3,c="undefined"!=typeof performance&&(performance.timing&&performance);c&&c.timing&&c.timing.navigationStart||(c=!1);i._=">",i.drift=0,i.is=function(t,n,e){var o=n&&t&&t[y]&&t[y][i._]||e;if(o)return v(o=o[n])?o:-1/0},i.lex=function(){return i().toString(36).replace(".","")},i.ify=function(t,n,o,r,s){if(!t||!t[y]){if(!s)return;t=e.soul.ify(t,s)}var a=p(t[y],i._);return f!==n&&n!==y&&(v(o)&&(a[n]=o),f!==r&&(t[n]=r)),t},i.to=function(t,n,o){var r=(t||{})[n];return d(r)&&(r=m(r)),i.ify(o,n,i.is(t,n),r,e.soul(t))},function(){function t(t,n){y!==n&&i.ify(this.o,n,this.s)}i.map=function(n,e,o){var r,s=d(s=n||e)?s:null;return n=b(n=n||e)?n:null,s&&!n?(e=v(e)?e:i(),s[y]=s[y]||{},g(s,t,{o:s,s:e}),s):(o=o||d(e)?e:r,e=v(e)?e:i(),function(i,s,a,u){if(!n)return t.call({o:a,s:e},i,s),i;n.call(o||this||{},i,s,a,u),h(a,s)&&r===a[s]||t.call({o:a,s:e},i,s)})}}();var f,l=n.obj,p=l.as,h=l.has,d=l.is,g=l.map,m=l.copy,v=n.num.is,b=n.fn.is,y=e._;t.exports=i}))(o,"./state"),o((function(t){var n=o("./type"),e=o("./val"),i=o("./node"),r={};!function(){function t(t,e){if(!t||e!==i.soul(t)||!i.is(t,this.fn,this.as))return!0;this.cb&&(n.n=t,n.as=this.as,this.cb.call(n.as,t,e,n))}function n(t){t&&i.is(n.n,t,n.as)}r.is=function(n,e,o,i){return!(!n||!a(n)||f(n))&&!p(n,t,{cb:e,fn:o,as:i})}}(),function(){function t(t,n){var r;return(r=function(t,n){var e,o=t.seen,i=o.length;for(;i--;)if(e=o[i],n.obj===e.obj)return e;o.push(n)}(t,n))?r:(n.env=t,n.soul=s,i.ify(n.obj,o,n)&&(n.link=n.link||e.link.ify(i.soul(n.node)),n.obj!==t.shell&&(t.graph[e.link.is(n.link)]=n.node)),n)}function o(n,o,r){var s,a,l=this,p=l.env;if(i._===o&&c(n,e.link._))return r._;if(s=f(n,o,r,l,p)){if(o||(l.node=l.node||r||{},c(n,i._)&&i.soul(n)&&(l.node._=h(n._)),l.node=i.soul.ify(l.node,e.link.is(l.link)),l.link=l.link||e.link.ify(i.soul(l.node))),(a=p.map)&&(a.call(p.as||{},n,o,r,l),c(r,o))){if(void 0===(n=r[o]))return void u(r,o);if(!(s=f(n,o,r,l,p)))return}if(!o)return l.node;if(!0===s)return n;if((a=t(p,{obj:n,path:l.path.concat(o)})).node)return a.link}}function s(t){var n=this,o=e.link.is(n.link),r=n.env.graph;n.link=n.link||e.link.ify(t),n.link[e.link._]=t,n.node&&n.node[i._]&&(n.node[i._][e.link._]=t),c(r,o)&&(r[t]=r[o],u(r,o))}function f(t,o,i,r,s){var u;return!!e.is(t)||(a(t)?1:(u=s.invalid)?f(t=u.call(s.as||{},t,o,i),o,i,r,s):(s.err="Invalid value at '"+r.path.concat(o).join(".")+"'!",void(n.list.is(t)&&(s.err+=" Use `.set(item)` instead of an Array."))))}r.ify=function(n,o,i){var r={path:[],obj:n};return o?"string"==typeof o?o={soul:o}:o instanceof Function&&(o.map=o):o={},o.soul&&(r.link=e.link.ify(o.soul)),o.shell=(i||{}).shell,o.graph=o.graph||{},o.seen=o.seen||[],o.as=o.as||i,t(o,r),o.root=r.node,o.graph}}(),r.node=function(t){var n=i.soul(t);if(n)return l({},n,t)},function(){function t(t,n){var o,s;if(i._!==n)(o=e.link.is(t))?(s=this.opt.seen[o])?this.obj[n]=s:this.obj[n]=this.opt.seen[o]=r.to(this.graph,o,this.opt):this.obj[n]=t;else{if(f(t,e.link._))return;this.obj[n]=h(t)}}r.to=function(n,e,o){if(n){var i={};return o=o||{seen:{}},p(n[e],t,{obj:i,graph:n,opt:o}),i}}}();n.fn.is;var s=n.obj,a=s.is,u=s.del,c=s.has,f=s.empty,l=s.put,p=s.map,h=s.copy;t.exports=r}))(o,"./graph"),o((function(t){o("./onto"),t.exports=function(t,n){if(this.on){if(!(t instanceof Function)){if(!t||!n)return;var e=t["#"]||t,o=(this.tag||empty)[e];if(!o)return;return o=this.on(e,n),clearTimeout(o.err),!0}e=n&&n["#"]||Math.random().toString(36).slice(2);if(!t)return e;var i=this.on(e,t,n);return i.err=i.err||setTimeout((function(){i.next({err:"Error: No ACK received yet.",lack:!0}),i.off()}),(this.opt||{}).lack||9e3),e}}}))(o,"./ask"),o((function(t){var n=o("./type");var e=n.time.is;t.exports=function(t){var o={s:{}};return t=t||{max:1e3,age:9e3},o.check=function(t){var n;return!!(n=o.s[t])&&(n.pass?n.pass=!1:o.track(t))},o.track=function(i,r){var s=o.s[i]||(o.s[i]={});return s.was=e(),r&&(s.pass=!0),o.to||(o.to=setTimeout((function(){var i=e();n.obj.map(o.s,(function(e,r){e&&t.age>i-e.was||n.obj.del(o.s,r)})),o.to=null}),t.age+9)),s},o}}))(o,"./dup"),o((function(t){function n(t){return t instanceof n?(this._={gun:this,$:this}).$:this instanceof n?n.create(this._={gun:this,$:this,opt:t}):new n(t)}n.is=function(t){return t instanceof n||t&&t._&&t===t._.$||!1},n.version=.9,n.chain=n.prototype,n.chain.toJSON=function(){};var r=o("./type");r.obj.to(r,n),n.HAM=o("./HAM"),n.val=o("./val"),n.node=o("./node"),n.state=o("./state"),n.graph=o("./graph"),n.on=o("./onto"),n.ask=o("./ask"),n.dup=o("./dup"),function(){function t(e){var o,i,r=this.as,a=r.at||r,u=a.$;(i=e["#"])||(i=e["#"]=f(9)),(o=a.dup).check(i)?r.out===e.out&&(e.out=s,this.to.next(e)):(o.track(i),a.ask(e["@"],e)||(e.get&&n.on.get(e,u),e.put&&n.on.put(e,u)),this.to.next(e),r.out||(e.out=t,a.on("out",e)))}n.create=function(e){e.root=e.root||e,e.graph=e.graph||{},e.on=e.on||n.on,e.ask=e.ask||n.ask,e.dup=e.dup||n.dup();var o=e.$.opt(e.opt);return e.once||(e.on("in",t,e),e.on("out",t,{at:e,out:t}),n.on("create",e),e.on("create",e)),e.once=1,o}}(),function(){function t(t,e,o,i){var r=this,s=n.state.is(o,e);if(!s)return r.err="Error: No state on '"+e+"' in node '"+i+"'!";var a=r.graph[i]||y,u=n.state.is(a,e,!0),c=a[e],f=n.HAM(r.machine,s,u,t,c);f.incoming?(r.put[i]=n.state.to(o,e,r.put[i]),(r.diff||(r.diff={}))[i]=n.state.to(o,e,r.diff[i]),r.souls[i]=!0):f.defer&&(r.defer=s<(r.defer||1/0)?s:r.defer)}function e(t,n){var e=this,s=e.$._,a=(s.next||y)[n];if(!a){if(!(s.opt||y).super)return void(e.souls[n]=!1);a=e.$.get(n)._}var u=e.map[n]={put:t,get:n,$:a.$},c={ctx:e,msg:u};e.async=!!s.tag.node,e.ack&&(u["@"]=e.ack),g(t,o,c),e.async&&(e.and||s.on("node",(function(t){this.to.next(t),t===e.map[t.get]&&(e.souls[t.get]=!1,g(t.put,i,t),g(e.souls,(function(t){if(t)return t}))||e.c||(e.c=1,this.off(),g(e.map,r,e)))})),e.and=!0,s.on("node",u))}function o(t,e){var o=this.ctx,i=o.graph,r=this.msg,s=r.get,a=r.put,u=r.$._;i[s]=n.state.to(a,e,i[s]),o.async||(u.put=n.state.to(a,e,u.put))}function i(t,e){var o=this.put,i=this.$._;i.put=n.state.to(o,e,i.put)}function r(t,n){t.$&&(this.cat.stop=this.stop,t.$._.on("in",t),this.cat.stop=null)}n.on.put=function(o,i){var a=i._,u={$:i,graph:a.graph,put:{},map:{},souls:{},machine:n.state(),ack:o["@"],cat:a,stop:{}};if(n.graph.is(o.put,null,t,u)||(u.err="Error: Invalid graph!"),u.err)return a.on("in",{"@":o["#"],err:n.log(u.err)});g(u.put,e,u),u.async||g(u.map,r,u),s!==u.defer&&setTimeout((function(){n.on.put(o,i)}),u.defer-u.machine),u.diff&&a.on("put",d(o,{put:u.diff}))},n.on.get=function(t,e){var o=e._,i=t.get,r=i[v],s=o.graph[r],a=i[b],u=(o.next||(o.next={}))[r];if(!s)return o.on("get",t);if(a){if("string"!=typeof a||!h(s,a))return o.on("get",t);s=n.state.to(s,a)}else s=n.obj.copy(s);s=n.graph.node(s),(u||y).ack,o.on("in",{"@":t["#"],how:"mem",put:s,$:e}),o.on("get",t)}}(),n.chain.opt=function(t){t=t||{};var e=this._,o=t.peers||t;return p(t)||(t={}),p(e.opt)||(e.opt=t),c(o)&&(o=[o]),a(o)&&(o=g(o,(function(t,n,e){e(t,{url:t})})),p(e.opt.peers)||(e.opt.peers={}),e.opt.peers=d(o,e.opt.peers)),e.opt.peers=e.opt.peers||{},d(t,e.opt),n.on("opt",e),e.opt.uuid=e.opt.uuid||function(){return m()+f(12)},this};var s,a=n.list.is,u=n.text,c=u.is,f=u.random,l=n.obj,p=l.is,h=l.has,d=l.to,g=l.map,m=(l.copy,n.state.lex),v=n.val.link._,b=".",y=(n.node._,n.val.link.is,{});e.debug=function(t,n){return e.debug.i&&t===e.debug.i&&e.debug.i++&&(e.log.apply(e,arguments)||n)},n.log=function(){return!n.log.off&&e.log.apply(e,arguments),[].slice.call(arguments).join(" ")},n.log.once=function(t,e,o){return(o=n.log.once)[t]=o[t]||0,o[t]++||n.log(e)},n.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, feel free to ask for help on https://gitter.im/amark/gun and ask StackOverflow questions tagged with 'gun'!"),"undefined"!=typeof window&&((window.GUN=window.Gun=n).window=window);try{void 0!==i&&(i.exports=n)}catch(t){}t.exports=n}))(o,"./root"),o((function(t){var n=o("./root");n.chain.back=function(t,o){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var r=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var s=0,a=t.length,u=r;s<a;s++)u=(u||i)[t[s]];return e!==u?o?this:u:(u=r.back)?u.$.back(t,o):void 0}if(t instanceof Function){var c;for(u={back:r};(u=u.back)&&e===(c=t(u,o)););return c}return n.num.is(t)?(r.back||r).$.back(t-1):this};var e,i={}}))(o,"./back"),o((function(t){var n=o("./root");function e(t){var e,o,i=this.as,r=i.back,s=i.root;if(t.$||(t.$=i.$),this.to.next(t),e=t.get){if(i.lex&&(t.get=m(i.lex,t.get)),e["#"]||i.soul){if(e["#"]=e["#"]||i.soul,t["#"]||(t["#"]=b(9)),r=s.$.get(e["#"])._,e=e["."]){if(d(r.put,e)){if((o=(a=r.$.get(e)._).ack)||(a.ack=-1),r.on("in",{$:r.$,put:n.state.to(r.put,e),get:r.get}),o)return}else if("string"!=typeof e){var a={},u=(r.put||{})._;n.obj.map(r.put,(function(t,o){n.text.match(o,e)&&(a[o]=t)})),n.obj.empty(a)||(a._=u,r.on("in",{$:r.$,put:a,get:r.get}))}}else{if((o=r.ack)||(r.ack=-1),d(r,"put")&&r.on("in",r),o)return;t.$=r.$}return s.ask(f,t),s.on("in",t)}if(s.now&&(s.now[i.id]=s.now[i.id]||!0,i.pass={}),e["."])return i.get?(t={get:{".":i.get},$:i.$},r.ask||(r.ask={}),r.ask[i.get]=t.$._,r.on("out",t)):(t={get:{},$:i.$},r.on("out",t));if(i.ack=i.ack||-1,i.get)return t.$=i.$,e["."]=i.get,(r.ask||(r.ask={}))[i.get]=t.$._,r.on("out",t)}return r.on("out",t)}function i(t){var e,o,i=this.as,a=i.root,f=(t.$||p)._||p,h=t.put;if(i.get&&t.get!==i.get&&(t=m(t,{get:i.get})),i.has&&f!==i&&(t=m(t,{$:i.$}),f.ack&&(i.ack=f.ack)),l===h){if(o=f.put,this.to.next(t),i.soul)return;if(l===o&&l!==f.put)return;return s(i,t),i.has&&c(i,t),g(f.echo,i.id),void g(i.map,f.id)}if(i.soul)return this.to.next(t),s(i,t),void(i.next&&v(h,u,{msg:t,cat:i}));if(!(e=n.val.link.is(h)))return n.val.is(h)?(i.has||i.soul?c(i,t):(f.has||f.soul)&&((f.echo||(f.echo={}))[i.id]=f.echo[f.id]||i,(i.map||(i.map={}))[f.id]=i.map[f.id]||{at:f}),this.to.next(t),void s(i,t)):(i.has&&f!==i&&d(f,"put")&&(i.put=f.put),(e=n.node.soul(h))&&f.has&&(f.put=i.root.$.get(e)._.put),o=(a.stop||{})[f.id],this.to.next(t),r(i,t,f,e),s(i,t),void(i.next&&v(h,u,{msg:t,cat:i})));a.stop;(o=(o=a.stop||{})[f.id]||(o[f.id]={})).is=o.is||f.put,o[i.id]=f.put||!0,this.to.next(t),r(i,t,f,e),s(i,t)}function r(t,e,o,i){if(i&&y!==t.get){var s=t.root.$.get(i)._;t.has?o=s:o.has&&r(o,e,o,i),o!==t&&(o.$||(o={}),(o.echo||(o.echo={}))[t.id]=o.echo[t.id]||t,t.has&&!(t.map||p)[o.id]&&c(t,e),(i!==(s=o.id?(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o}:{}).link||s.pass||t.pass)&&(t.pass&&(n.obj.map(t.map,(function(t){t.pass=!0})),g(t,"pass")),s.pass&&g(s,"pass"),t.has&&(t.link=i),function(t,e){var o=t.root.$.get(e)._;if(t.ack&&(o.on("out",{get:{"#":e}}),!t.ask))return;o=t.ask,n.obj.del(t,"ask"),v(o||t.next,(function(t,n){t.on("out",{get:{"#":e,".":n}})})),n.obj.del(t,"ask")}(t,s.link=i)))}}function s(t,n,e){t.echo&&v(t.echo,a,n)}function a(t){t&&t.on&&t.on("in",this)}function u(t,e){var o,i,r,s=this.cat.next||p,a=this.msg;(y!==e||s[e])&&(i=s[e])&&(i.has?(l!==i.put&&n.val.link.is(t)||(i.put=t),o=i.$):(r=a.$)&&(r=(o=a.$.get(e))._,l!==r.put&&n.val.link.is(t)||(r.put=t)),i.on("in",{put:t,get:e,$:o,via:a}))}function c(t,e){if(t.has||t.soul){var o=t.map;t.root;t.map=null,t.has&&(t.dub&&t.root.stop&&(t.dub=null),t.link=null),(t.pass||e["@"]||null!==o)&&(l===o&&n.val.link.is(t.put)||(v(o,(function(n){(n=n.at)&&g(n.echo,t.id)})),o=t.put,v(t.next,(function(n,e){if(l===o&&l!==t.put)return!0;n.put=l,n.ack&&(n.ack=-1),n.on("in",{get:e,$:n.$,put:l})}))))}}function f(t,e){var o=this.as,i=o.get||p,r=o.$._,s=(t.put||p)[i["#"]];if(r.ack&&(r.ack=r.ack+1||1),t.put&&("string"!=typeof i["."]||d(s,r.get)))y!=i["."]?n.on.put(t,r.root.$):r.on("in",{get:r.get,put:n.val.link.ify(i["#"]),$:r.$,"@":t["@"]});else{if(r.put!==l)return;r.on("in",{get:r.get,put:r.put=l,$:r.$,"@":t["@"]})}}n.chain.chain=function(t){var o,r=this._,s=new(t||this).constructor(this),a=s._;return a.root=o=r.root,a.id=++o.once,a.back=this._,a.on=n.on,a.on("in",i,a),a.on("out",e,a),s};var l,p={},h=n.obj,d=h.has,g=(h.put,h.del),m=h.to,v=h.map,b=n.text.random,y=(n.val.link._,n.node._)}))(o,"./chain"),o((function(t){var n=o("./root");function e(t){var e,o=this,i=o.as,s=i.at.root,a=(t.$||{})._||{},c=t.put||a.put;if((e=s.now)&&o!==e[i.now])return o.to.next(t);if(o.seen&&a.id&&o.seen[a.id])return o.to.next(t);if((e=c)&&e[f._]&&(e=f.is(e))&&(e=(t.$$=a.root.gun.get(e))._,r!==e.put&&(t=u(t,{put:c=e.put}))),(e=s.mum)&&a.id){var l=a.id+(o.id||(o.id=n.text.random(9)));if(e[l])return;r===c||f.is(c)||(e[l]=!0)}i.use(t,o),o.stun?o.stun=null:o.to.next(t)}function i(t){var n=this.on;if(!t||n.soul||n.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){var e;n.map;if((e=this.seen||(this.seen={}))[t])return!0;e[t]=!0}}n.chain.get=function(t,o,u){var h;if("string"!=typeof t){if(t instanceof Function){if(!0===o)return function(t,n,e,o){var i,s=t._,u=0;if(i=s.soul||s.link||s.dub)return n(i,o,s),t;return t.get((function(t,e){if(!(r===t.put&&(i=(a(s.root.opt.peers,(function(t,n,e){e(n)}))||[]).length)&&++u<i)){e.rid(t);var c=(c=t.$)&&c._||{};i=c.link||c.soul||f.is(t.put)||l(t.put)||c.dub,n(i,o,t,e)}}),{out:{get:{".":!0}}}),t}(this,t,0,u);var d,g=(h=this)._,m=g.root,v=m.now;(u=o||{}).at=g,u.use=t,u.out=u.out||{},u.out.get=u.out.get||{},(d=g.on("in",e,u)).rid=i,(m.now={$:1})[u.now=g.id]=d;var b=m.mum;return m.mum={},g.on("out",u.out),m.mum=b,m.now=v,h}return c(t)?this.get(""+t,o,u):(v=f.is(t))?this.get(v,o,u):s.is(t)?(h=this,(v=((v=t["#"])||p)["="]||v)&&(h=h.get(v)),h._.lex=t,h):((u=this.chain())._.err={err:n.log("Invalid get request!",t)},o&&o.call(u,u._.err),u)}return(h=(this._.next||p)[t])||(h=function(t,n){var e=n._,o=e.next,i=n.chain()._;o||(o=e.next={});o[i.get=t]=i,n===e.root.$?i.soul=t:(e.soul||e.has)&&(i.has=t);return i}(t,this)),h=h.$,(v=this._.stun)&&(h._.stun=h._.stun||v),o&&o instanceof Function&&h.get(o,u),h};var r,s=n.obj,a=s.map,u=(s.has,n.obj.to),c=n.num.is,f=n.val.link,l=n.node.soul,p=(n.node._,{})}))(o,"./get"),o((function(t){var n=o("./root");function i(t){t&&t()}function r(){var t=this;t.graph&&!d(t.stun,s)&&(t.res=t.res||function(t){t&&t()},t.res((function(){var e=t.$.back(-1)._,o=e.ask((function(o){e.root.on("ack",o),o.err&&n.log(o),o.lack||this.off(),t.ack&&t.ack(o,this)}),t.opt),i=e.root.now;l.del(e.root,"now");var r=e.root.mum;e.root.mum={},t.ref._.on("out",{$:t.ref,put:t.out=t.env.graph,opt:t.opt,"#":o}),e.root.mum=r?l.to(r,e.root.mum):r,e.root.now=i}),t),t.res&&t.res())}function s(t,n){if(t)return!0}function a(t,e,o,i){var r=this,s=n.is(t);!e&&i.path.length&&(r.res||v)((function(){for(var e=i.path,o=r.ref,a=(r.opt,0),c=e.length;a<c;a++)o=o.get(e[a]);s&&(o=t);var f=o._.dub;if(f||(f=n.node.soul(i.obj)))return o.back(-1).get(f),void i.soul(f);(r.stun=r.stun||{})[e]=!0,o.get(u,!0,{as:{at:i,as:r,p:e}})}),{as:r,at:i})}function u(t,e,o,i){var r=(e=e.as).at;e=e.as;var s=((o||{}).$||{})._||{};t=s.dub=s.dub||t||n.node.soul(r.obj)||n.node.soul(o.put||s.put)||n.val.link.is(o.put||s.put)||(e.via.back("opt.uuid")||n.text.random)(),i&&(i.stun=!0),t?c(s,s.dub=t,r,e):s.via.back("opt.uuid")((function(t,o){if(t)return n.log(t);c(s,s.dub=s.dub||o,r,e)}))}function c(t,n,e,o){t.$.back(-1).get(n),e.soul(n),o.stun[e.path]=!1,o.batch()}function f(t,o,i,r){if(o=o.as,i.$&&i.$._)if(i.err)e.log("Please report this as an issue! Put.any.err");else{var s,a=i.$._,u=a.put,c=o.opt||{};if(!(s=o.ref)||!s._.now){if(r&&(r.stun=!0),o.ref!==o.$){if(!(s=o.$._.get||a.get))return void e.log("Please report this as an issue! Put.no.get");o.data=h({},s,o.data),s=null}if(void 0===u){if(!a.get)return;t||(s=a.$.back((function(t){if(t.link||t.soul)return t.link||t.soul;o.data=h({},t.get,o.data)}))),a=(s=s||a.soul||a.link||a.dub)?a.root.$.get(s)._:a,o.soul=s,u=o.data}o.not||(o.soul=o.soul||t)||(o.path&&p(o.data)?o.soul=(c.uuid||o.via.back("opt.uuid")||n.text.random)():(b==a.get&&(o.soul=(a.put||g)["#"]||a.dub),o.soul=o.soul||a.soul||a.link||(c.uuid||o.via.back("opt.uuid")||n.text.random)()),o.soul)?o.ref.put(o.data,o.soul,o):o.via.back("opt.uuid")((function(t,e){if(t)return n.log(t);o.ref.put(o.data,o.soul=e,o)}))}}}n.chain.put=function(t,e,o){var s,u=this,c=u._,l=c.root.$,d=l._;if(!d.puta)if(s=d.puts){if(s>100){if((d.stack||(d.stack=[])).push([u,t,e,o]),d.puto)return;return d.puto=setTimeout((function t(){var n,e=d.stack.splice(0,100),o=0;for(d.puta=!0;n=e[o++];)n[0].put(n[1],n[2],n[3]);if(delete d.puta,d.stack.length)return d.puto=setTimeout(t,0);d.stack=d.puts=d.puto=null}),0),u}++d.puts}else d.puts=1;return(o=o||{}).data=t,o.via=o.$=o.via||o.$||u,"string"==typeof e?o.soul=e:o.ack=o.ack||e,c.soul&&(o.soul=c.soul),o.soul||l===u?p(o.data)?(o.soul=o.soul||(o.not=n.node.soul(o.data)||(o.via.back("opt.uuid")||n.text.random)()),o.soul?(o.$=l.get(o.soul),o.ref=o.$,function(t){t.batch=r;var e=t.opt||{},o=t.env=n.state.map(a,e.state);if(o.soul=t.soul,t.graph=n.graph.ify(t.data,o,t),o.err)return(t.ack||m).call(t,t.out={err:n.log(o.err)}),void(t.res&&t.res());t.batch()}(o),u):(o.via.back("opt.uuid")((function(t,e){if(t)return n.log(t);(o.ref||o.$).put(o.data,o.soul=e,o)})),u)):((o.ack||m).call(o,o.out={err:n.log("Data saved to the root level of the graph must be a node (an object), not a",typeof o.data,'of "'+o.data+'"!')}),o.res&&o.res(),u):n.is(t)?(t.get((function(t,i,r){if(!t)return n.log("The reference you are saving is a",typeof r.put,'"'+r.put+'", not a node (object)!');u.put(n.val.link.ify(t),e,o)}),!0),u):(c.has&&(s=n.val.link.is(t))&&(c.dub=s),o.ref=o.ref||l._===(s=c.back)?u:s.$,o.ref._.soul&&n.val.is(o.data)&&c.get?(o.data=h({},c.get,o.data),o.ref.put(o.data,o.soul,o),u):(o.ref.get(f,!0,{as:o}),o.out||(o.res=o.res||i,o.$._.stun=o.ref._.stun),u))};var l=n.obj,p=l.is,h=l.put,d=l.map,g={},m=function(){},v=function(t,n){t.call(n||g)},b=n.node._}))(o,"./put"),o((function(t){var n=o("./root");o("./chain"),o("./back"),o("./put"),o("./get"),t.exports=n}))(o,"./index"),o((function(t){var n=o("./index");function e(t,n){var e,o=t.$,i=((o||{})._||{}).put||t.put;this.at;if(r!==i){if(e=t.$$){if(e=t.$$._,r===e.put)return;i=e.put}this.change&&(i=t.put),this.as?this.ok.call(this.as,t,n):this.ok.call(o,i,t.get,t,n)}}function i(t,e,o){if(t.$){var s,u,f=this.as,l=(f.at,t.$),p=l._,h=p.put||t.put;(u=t.$$)&&(s=u=t.$$._,r!==s.put&&(h=s.put)),(u=e.wait)&&(u=u[p.id])&&clearTimeout(u),!o&&(r===h||p.soul||p.link||s&&!(0<s.ack))||r===h&&(u=(a(p.root.opt.peers,(function(t,n,e){e(n)}))||[]).length)&&!o&&(s||p).ack<=u?u=(e.wait={})[p.id]=setTimeout((function(){i.call({as:f},t,e,u||1)}),f.wait||99):(s&&r===s.put&&(u=c.is(h))&&(h=n.node.ify({},u)),e.rid(t),f.ok.call(l||f.$,h,t.get))}else e.off()}n.chain.on=function(t,n,o,i){var r,s=this._;if("string"==typeof t)return n?(r=s.on(t,n,o||s,i),o&&o.$&&(o.subs||(o.subs=[])).push(r),this):s.on(t);var a=n;return(a=!0===a?{change:!0}:a||{}).at=s,a.ok=t,this.get(e,a),this},n.chain.val=function(t,e){return n.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,e)},n.chain.once=function(t,e){var o=this,s=o._,a=s.put;if(0<s.ack&&r!==a)return(t||f).call(o,a,s.get),o;if(!t){n.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var u=o.chain();return u._.nix=o.once((function(){u._.on("in",o._)})),u}return(e=e||{}).ok=t,e.at=s,e.out={"#":n.text.random(9)},o.get(i,{as:e}),e.async=!0,o},n.chain.off=function(){var t,n=this._,e=n.back;if(e)return(t=e.next)&&t[n.get]&&u(t,n.get),(t=e.ask)&&u(t,n.get),(t=e.put)&&u(t,n.get),(t=n.soul)&&u(e.root.graph,t),(t=n.map)&&a(t,(function(t){t.link&&e.root.$.get(t.link).off()})),(t=n.next)&&a(t,(function(t){t.$.off()})),n.on("off",{}),this};var r,s=n.obj,a=s.map,u=(s.has,s.del),c=(s.to,n.val.link),f=function(){}}))(o,"./on"),o((function(t){var n=o("./index");function e(t){if(!t.put||n.val.is(t.put))return this.to.next(t);this.as.nix&&this.off(),r(t.put,i,{at:this.as,msg:t}),this.to.next(t)}function i(t,e){if(a!==e){var o=this.msg.$,i=o._,r=this.at,s=i.lex;s&&!n.text.match(e,s["."]||s["#"]||s)||(((s=o.get(e)._).echo||(s.echo={}))[r.id]=s.echo[r.id]||r)}}n.chain.map=function(t,o,i){var r,a=this._;return t?(n.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),r=this.chain(),this.map().on((function(e,o,i,a){var u=(t||s).call(this,e,o,i,a);if(void 0!==u)return e===u?r._.on("in",i):n.is(u)?r._.on("in",u._):void r._.on("in",{get:o,put:u})})),r):((r=a.each)||(a.each=r=this.chain(),r._.nix=this.back("nix"),this.on("in",e,r._)),r)};var r=n.obj.map,s=function(){},a=n.node._}))(o,"./map"),o((function(t){var n=o("./index");n.chain.set=function(t,e,o){var i,r=this;return e=e||function(){},(o=o||{}).item=o.item||t,(i=n.node.soul(t))&&(t=n.obj.put({},i,n.val.link.ify(i))),n.is(t)?(t.get((function(t,i,s){if(!t)return e.call(r,{err:n.log('Only a node can be linked! Not "'+s.put+'"!')});r.put(n.obj.put({},t,n.val.link.ify(t)),e,o)}),!0),t):(n.obj.is(t)&&(t=r.back(-1).get(i=i||n.node.soul(t)||r.back("opt.uuid")()).put(t)),r.get(i||n.state.lex()+n.text.random(7)).put(t,e,o))}}))(o,"./set"),o((function(t){if("undefined"!=typeof Gun){var n;try{n=(Gun.window||function(){}).localStorage}catch(t){}n||(e.log("Warning: No localStorage exists to persist data to!"),n={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",(function(t){var e=this.to,o=t.opt;if(t.once)return e.next(t);o.prefix=o.file||"gun/";var i,r,s=Gun.obj.ify(n.getItem("gap/"+o.prefix))||{},a=Gun.obj.empty;if(!a(s)){var u=Gun.obj.ify(n.getItem(o.prefix))||{},c={};Gun.obj.map(s,(function(t,n){Gun.obj.map(t,(function(t,e){c[n]=Gun.state.to(u[n],e,c[n])}))})),setTimeout((function(){t.on("out",{put:c,"#":t.ask(f)})}),1)}function f(t){if(!t.err&&t.ok){var n=t["@"];setTimeout((function(){Gun.obj.map(s,(function(t,e){Gun.obj.map(t,(function(e,o){n===e&&delete t[o]})),a(t)&&delete s[e]})),p()}),o.wait||1)}}t.on("out",(function(t){t.lS||(Gun.is(t.$)&&t.put&&!t["@"]&&!a(o.peers)&&(i=t["#"],Gun.graph.is(t.put,null,l),r||(r=setTimeout(p,o.wait||1))),this.to.next(t))})),t.on("ack",f),e.next(t);var l=function(t,n,e,o){(s[o]||(s[o]={}))[n]=i},p=function(){clearTimeout(r),r=!1;try{n.setItem("gap/"+o.prefix,JSON.stringify(s))}catch(t){Gun.log(err=t||"localStorage failure")}}})),Gun.on("create",(function(t){this.to.next(t);var e=t.opt;if(!t.once&&!1!==e.localStorage){e.prefix=e.file||"gun/";t.graph;var o,i={},r=0,s=Gun.obj.ify(n.getItem(e.prefix))||{};t.on("localStorage",s),t.on("put",(function(t){if(this.to.next(t),Gun.graph.is(t.put,null,a),t["@"]||(i[t["#"]]=!0),(r+=1)>=(e.batch||1e3))return u();o||(o=setTimeout(u,e.wait||1))})),t.on("get",(function(n){this.to.next(n);var o,i,r=n.get;function a(){if(r&&(o=r["#"])){var a=r["."];(i=s[o]||void 0)&&a&&(i=Gun.state.to(i,a)),(i||Gun.obj.empty(e.peers))&&t.on("in",{"@":n["#"],put:Gun.graph.node(i),how:"lS",lS:n.$||t.$})}}Gun.debug?setTimeout(a,1):a()}));var a=function(t,n,e,o){s[o]=Gun.state.to(e,n,s[o])},u=function(a){var c;r=0,clearTimeout(o),o=!1;var f=i;i={},a&&(s=a);try{n.setItem(e.prefix,JSON.stringify(s))}catch(n){Gun.log(c=(n||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, temporary example at https://github.com/amark/gun/blob/master/test/tmp/indexedDB.html ."),t.on("localStorage:error",{err:c,file:e.prefix,flush:s,retry:u})}(c||Gun.obj.empty(e.peers))&&Gun.obj.map(f,(function(n,e){t.on("in",{"@":e,err:c,ok:0})}))}}}))}}))(o,"./adapters/localStorage"),o((function(t){var n=o("../index"),i=o("../type");function r(t){var o=function(){},a=t.opt||{};return a.log=a.log||e.log,a.gap=a.gap||a.wait||1,a.pack=a.pack||.3*(a.memory?1e3*a.memory*1e3:1399e6),o.out=function(e){var i;if(this.to&&this.to.next(e),(i=e["@"])&&(i=t.dup.s[i])&&(i=i.it)&&i._)return o.say(e,i._.via,1),void(i["##"]=e["##"]);n.AXE?n.AXE.say(e,o.say,this):o.say(e)},t.on("create",(function(n){n.opt.pid=n.opt.pid||i.text.random(9),this.to.next(n),t.on("out",o.out)})),o.hear=function(n,e){if(n){var r,s,u,c=t.dup,f=n[0];if(a.pack<=n.length)return o.say({dam:"!",err:"Message too big!"},e);if("{"===f){try{u=JSON.parse(n)}catch(t){a.log("DAM JSON parse error",t)}if(!u)return;if(c.check(r=u["#"]))return;if(c.track(r,!0).it=u,(f=u["@"])&&u.put&&(f+=s=u["##"]||(u["##"]=o.hash(u)))!=r){if(c.check(f))return;(f=c.s)[s]=f[r]}return(u._=function(){}).via=e,(f=u["><"])&&(u._.to=i.obj.map(f.split(","),(function(t,n,e){e(t,!0)}))),u.dam?void((f=o.hear[u.dam])&&f(u,e,t)):void t.on("in",u)}if("["!==f);else{try{u=JSON.parse(n)}catch(t){a.log("DAM JSON parse error",t)}if(!u)return;for(var l,p=0;l=u[p++];)o.hear(l,e)}}},function(){function n(t){var n=t.batch;if(n&&(t.batch=t.tail=null,n.length))try{e(JSON.stringify(n),t)}catch(t){a.log("DAM JSON stringify error",t)}}function e(t,n){var e=n.wire;try{n.say?n.say(t):e.send&&e.send(t)}catch(e){(n.queue=n.queue||[]).push(t)}}o.say=function(r,u,c){var f,l,p;if(u){if((u.wire||a.wire&&a.wire(u))&&(l=r._||s,u!==l.via&&((p=l.raw)||(p=o.raw(r)),!((f=r["@"])&&(f=t.dup.s[f])&&(f=f.it)&&f.get&&f["##"]&&f["##"]===r["##"])&&(!(f=l.to)||!f[u.url]&&!f[u.id]||c)))){if(u.batch){if(u.tail=(u.tail||0)+p.length,u.tail<=a.pack)return void u.batch.push(p);n(u)}u.batch=[],setTimeout((function(){n(u)}),a.gap),e(p,u)}}else i.obj.map(a.peers,(function(t){o.say(r,t)}))}}(),function(){function n(t,n){var o;return n instanceof Object?(i.obj.map(Object.keys(n).sort(),e,{to:o={},on:n}),o):n}function e(t){this.to[t]=this.on[t]}o.raw=function(e){if(!e)return"";var r,c,f,l=t.dup,p=e._||{};if(f=p.raw)return f;if("string"==typeof e)return e;e["@"]&&(f=e.put)&&((c=e["##"])||(r=s(f,n)||"",c=o.hash(e,r),e["##"]=c),(f=l.s)[c=e["@"]+c]=f[e["#"]],e["#"]=c||e["#"],r&&((e=i.obj.to(e)).put=u));var h=0,d=[];i.obj.map(a.peers,(function(t){if(d.push(t.url||t.id),++h>9)return!0})),e["><"]=d.join();var g=s(e);return void 0!==r&&(f=g.indexOf(u,g.indexOf("put")),g=g.slice(0,f-1)+r+g.slice(f+u.length+1)),p&&(p.raw=g),g},o.hash=function(t,e){return r.hash(e||s(t.put,n)||"")||t["#"]||i.text.random(9)};var s=JSON.stringify,u=":])([:"}(),o.hi=function(n){var e=n.wire||{};n.id||n.url?(a.peers[n.url||n.id]=n,i.obj.del(a.peers,e.id)):(e=e.id=e.id||i.text.random(9),o.say({dam:"?"},a.peers[e]=n)),e.hied||t.on(e.hied="hi",n)},o.bye=function(n){i.obj.del(a.peers,n.id),t.on("bye",n)},o.hear["!"]=function(t,n){a.log("Error:",t.err)},o.hear["?"]=function(t,n){if(!t.pid){o.say({dam:"?",pid:a.pid,"@":t["#"]},n);var e=n.queue;return n.queue=[],void i.obj.map(e,(function(t){o.say(t,n)}))}n.id=n.id||t.pid,o.hi(n)},o}r.hash=function(t){if("string"!=typeof t)return{err:1};var n=0;if(!t.length)return n;for(var e=0,o=t.length;e<o;++e)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n};var s={};Object.keys=Object.keys||function(t){return map(t,(function(t,n,e){e(n)}))};try{t.exports=r}catch(t){}}))(o,"./adapters/mesh"),o((function(t){var n=o("../index");n.Mesh=o("./mesh"),n.on("opt",(function(t){this.to.next(t);var e=t.opt;if(!t.once&&!1!==e.WebSocket){var o;"undefined"!=typeof window&&(o=window),void 0!==at&&(o=at),o=o||{};var i=e.WebSocket||o.WebSocket||o.webkitWebSocket||o.mozWebSocket;if(i){e.WebSocket=i;e.mesh=e.mesh||n.Mesh(t),e.wire;e.wire=r}}function r(t){try{if(!t||!t.url)return o&&o(t);var n=t.url.replace("http","ws"),o=t.wire=new e.WebSocket(n);return o.onclose=function(){e.mesh.bye(t),s(t)},o.onerror=function(n){s(t),n&&n.code},o.onopen=function(){e.mesh.hi(t)},o.onmessage=function(n){n&&e.mesh.hear(n.data||n,t)},o}catch(t){}}function s(t){clearTimeout(t.defer),t.defer=setTimeout((function(){r(t)}),2e3)}}))}))(o,"./adapters/websocket")}()}));const ct=function(){const t=new ut(["https://side.land/gun","https://www.raygun.live/gun","https://phrassed.com/gun"]),n="scroll.chat.0.0.3^"+window.location.href,{subscribe:e,update:o}=z([]),i=t.get(n);return i.map().on((t,n)=>{o(e=>{if(!t)return function(t,n){for(let e in t)if(t[e].msgId==n){t.splice(e,1);break}}(e,n),e;const o=new Date;if(e=e.filter(t=>"msg"===t.type||"pres"===t.type&&o-t.time<6e4),"pres"===t.type){const o=e.findIndex(n=>"pres"===n.type&&n.user===t.user);if(o>-1){const i=(new Date).getTime();return e[o]={msgId:n,msg:t.msg,time:i,user:t.user,yRel:t.yRel,type:"pres"},e}}return t&&e.push({msgId:n,msg:t.msg,time:parseFloat(t.time),user:t.user,yRel:t.yRel,type:t.msg.length>0?"msg":"pres"}),e.length>200&&e.shift(),e})}),{subscribe:e,deletePresence:t=>{const n="0_"+t;i.get(n).put(null)},setPresence:({user:t,yRel:n})=>{if(n<=0||n>=1)return;const e=(new Date).getTime(),o=`${e}_${t}`;let r={msg:"",user:t,yRel:n,time:e,type:"pres"};i.get(o).put(r)},pushMessage:({msg:t,user:n,yRel:e})=>{if(e<=0||e>=1)return;const o=(new Date).getTime(),r=`${o}_${n}`,s={msg:t,user:n,yRel:e,time:o,type:"msg"};console.log(s),i.get(r).put(s)}}}(),ft=W(ct,t=>t.filter(t=>"msg"===t.type)),lt=W(ct,t=>t.filter(t=>"pres"===t.type)),pt=t=>{if(!t)return;const n=[60,360],e=[75,100],o=[70,71];function i(t,n,e){const o=e-n;return(t%o+o)%o+n}let r=0;if(0===t)return r;for(let n=0;n<t.length;n++)r=t.charCodeAt(n)+((r<<5)-r),r&=r;return`hsl(${i(r,n[0],n[1])}, ${i(r,e[0],e[1])}%, ${i(r,o[0],o[1])}%)`},{setTimeout:ht,window:dt}=D;function gt(t,n,e){const o=t.slice();return o[31]=n[e],o}function mt(t,n,e){const o=t.slice();return o[34]=n[e],o}function vt(t,n){let e,o,i,r,s=n[34].msg+"";return{key:t,first:null,c(){e=l("div"),o=l("span"),i=p(s),r=h(),g(o,"class","chat-message"),b(o,"filter","drop-shadow(4px 4px 4px "+pt(n[34].user)+")"),b(o,"will-change","filter"),g(e,"class","chat-message-container"),b(e,"top",n[34].yRel*n[4]+"px"),this.first=e},m(t,n){c(t,e,n),u(e,o),u(o,i),u(e,r)},p(t,n){1024&n[0]&&s!==(s=t[34].msg+"")&&m(i,s),1024&n[0]&&b(o,"filter","drop-shadow(4px 4px 4px "+pt(t[34].user)+")"),1040&n[0]&&b(e,"top",t[34].yRel*t[4]+"px")},d(t){t&&f(e)}}}function bt(t,n){let e;return{key:t,first:null,c(){e=l("div"),g(e,"class","chat-presence"),b(e,"top",n[31].yRel*n[4]+"px"),b(e,"background-color",pt(n[31].user)),this.first=e},m(t,n){c(t,e,n)},p(t,n){2064&n[0]&&b(e,"top",t[31].yRel*t[4]+"px"),2048&n[0]&&b(e,"background-color",pt(t[31].user))},d(t){t&&f(e)}}}function yt(n){let e,i,r,s,a,y,k,x,w,$,_,j,S,T,A,N,G,M,I,E=!1,D=()=>{E=!1},P=[],C=new Map,F=[],H=new Map,z=n[12](n[1],n[6])?"< hide":"> chat";O(n[27]),O(n[28]);let W=n[10];const q=t=>t[34].msgId;for(let t=0;t<W.length;t+=1){let e=mt(n,W,t),o=q(e);C.set(o,P[t]=vt(o,e))}let L=n[11];const B=t=>t[31].msgId;for(let t=0;t<L.length;t+=1){let e=gt(n,L,t),o=B(e);H.set(o,F[t]=bt(o,e))}return{c(){i=l("div"),r=l("div"),s=h(),a=l("div");for(let t=0;t<P.length;t+=1)P[t].c();k=h(),x=l("div");for(let t=0;t<F.length;t+=1)F[t].c();w=h(),$=l("div"),_=l("form"),j=l("div"),S=l("input"),A=h(),N=l("div"),G=l("button"),M=p(z),this.c=t,g(r,"class","chat-sidebar"),b(r,"height",n[4]+"px"),g(a,"class","chat-messages"),a.hidden=y=!n[12](n[1],n[6]),g(x,"class","chat-presences"),b(S,"filter","drop-shadow(4px 4px 4px "+pt(n[9])+")"),g(S,"class","input"),g(S,"type","text"),g(S,"name","null"),g(S,"maxlength","160"),g(S,"placeholder","new message"),g(_,"method","get"),g(_,"autocomplete","off"),g($,"class","new-message"),$.hidden=T=!n[12](n[1],n[6]),b($,"position",n[8]?"relative":"fixed"),b($,"bottom","-"+(n[8]||"0")+"px"),g(G,"class","toggle-chat-button"),g(N,"class","chat-toolbar"),b(N,"filter","drop-shadow(4px 4px 4px "+pt(n[9])+")"),g(i,"class","scroll-chat-container"),b(i,"--color-bg",_t(n[0])?kt:wt),b(i,"--color-fg",_t(n[0])?$t:xt),b(i,"--color-bg-input",$t),b(i,"--color-fg-input",xt)},m(t,f,l){c(t,i,f),u(i,r),u(i,s),u(i,a);for(let t=0;t<P.length;t+=1)P[t].m(a,null);u(i,k),u(i,x);for(let t=0;t<F.length;t+=1)F[t].m(x,null);var p;u(i,w),u(i,$),u($,_),u(_,j),u(j,S),n[29](S),v(S,n[5]),u(i,A),u(i,N),u(N,G),u(G,M),l&&o(I),I=[d(dt,"scroll",()=>{E=!0,clearTimeout(e),e=ht(D,100),n[27]()}),d(dt,"resize",n[28]),d(r,"click",n[15]),d(S,"input",n[30]),d(S,"keydown",n[13]),d(S,"focus",n[17]),d(_,"submit",(p=n[26],function(t){return t.preventDefault(),p.call(this,t)})),d(G,"click",n[16]),d(i,"mousemove",n[14])]},p(t,n){if(4&n[0]&&!E&&(E=!0,clearTimeout(e),scrollTo(dt.pageXOffset,t[2]),e=ht(D,100)),16&n[0]&&b(r,"height",t[4]+"px"),1040&n[0]){const e=t[10];P=R(P,n,q,1,t,e,C,a,J,vt,null,mt)}if(66&n[0]&&y!==(y=!t[12](t[1],t[6]))&&(a.hidden=y),2064&n[0]){const e=t[11];F=R(F,n,B,1,t,e,H,x,J,bt,null,gt)}512&n[0]&&b(S,"filter","drop-shadow(4px 4px 4px "+pt(t[9])+")"),32&n[0]&&S.value!==t[5]&&v(S,t[5]),66&n[0]&&T!==(T=!t[12](t[1],t[6]))&&($.hidden=T),256&n[0]&&b($,"position",t[8]?"relative":"fixed"),256&n[0]&&b($,"bottom","-"+(t[8]||"0")+"px"),66&n[0]&&z!==(z=t[12](t[1],t[6])?"< hide":"> chat")&&m(M,z),512&n[0]&&b(N,"filter","drop-shadow(4px 4px 4px "+pt(t[9])+")"),1&n[0]&&b(i,"--color-bg",_t(t[0])?kt:wt),1&n[0]&&b(i,"--color-fg",_t(t[0])?$t:xt)},i:t,o:t,d(t){t&&f(i);for(let t=0;t<P.length;t+=1)P[t].d();for(let t=0;t<F.length;t+=1)F[t].d();n[29](null),o(I)}}}let kt="#000000aa",xt="#000000",wt="#ffffffdd",$t="#ffffff";function _t(t){return"dark"===t}function jt(t,n,e){let o,i,r;a(t,st,t=>e(9,o=t)),a(t,ft,t=>e(10,i=t)),a(t,lt,t=>e(11,r=t));let s,u,{theme:c="light"}=n,{chat:f="open"}=n,l=0,p=0,h=0,d=!1,g=0,m=1,v=!0,b=!1,y=null;function k(){s&&(ct.pushMessage({msg:s,user:o,yRel:w()}),e(5,s=""))}function w(){return y?(y-30)/m:(p+g-160)/m}function _(){ct.setPresence({user:o,yRel:w()})}function j(){ct.deletePresence(o)}return x(async()=>{e(4,m=document.documentElement.scrollHeight);setInterval(()=>{let t=h!==p;d!==t&&(d=t,d||(_(),e(8,y=null))),h=p},200);document.addEventListener("visibilitychange",()=>{"visible"!==document.visibilityState&&j()}),window.onresize=()=>{setTimeout(()=>{e(4,m=document.documentElement.scrollHeight)},0)}}),t.$set=t=>{"theme"in t&&e(0,c=t.theme),"chat"in t&&e(1,f=t.chat)},[c,f,p,g,m,s,v,u,y,o,i,r,function(t,n){return!("closed"===t&&!b)&&n},function(t){if(13===t.keyCode){if(!s)return;t.preventDefault(),k()}else 27===t.keyCode&&v&&(t.preventDefault(),e(6,v=!1))},function(t){l=t.clientY},async function(){e(8,y=p+l),_(),setTimeout(()=>{u.focus()},0)},async function(){e(6,v=!v),b=!0,v?setTimeout(()=>{u.focus()},0):ct.deletePresence(o)},function(t){_()},l,h,d,b,k,w,_,j,function(n){!function(t,n){const e=t.$$.callbacks[n.type];e&&e.slice().forEach(t=>t(n))}(t,n)},function(){e(2,p=dt.pageYOffset)},function(){e(3,g=dt.innerHeight)},function(t){$[t?"unshift":"push"](()=>{e(7,u=t)})},function(){s=this.value,e(5,s)}]}class St extends F{constructor(t){super(),this.shadowRoot.innerHTML="<style>.scroll-chat-container{width:100vw}.chat-sidebar{position:absolute;background-color:var(--color-bg);width:1rem;z-index:40;padding:0px}.chat-messages{position:absolute;background-color:transparent;width:auto;padding-left:1rem}.chat-message-container{position:absolute;width:calc(100vw - 10px)}.chat-message{color:var(--color-fg);font-size:1rem;font-family:sans-serif;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;background-color:var(--color-bg)}.chat-presences{position:absolute;background-color:transparent;width:auto;padding-left:0px}.chat-presence{position:absolute;width:0.9rem;height:0.9rem;z-index:60;border:solid;border-width:1px;border-color:var(--color-bg-input)}.new-message{position:fixed;bottom:0px;padding-bottom:4.5rem;padding-left:1rem;padding-right:50px}.new-message input{background:var(--color-bg-input);font-size:1.125rem;font-family:sans-serif;padding:1rem;height:20px;width:calc(100vw - 4rem);border:solid;border-width:2px}.chat-toolbar{background-color:var(--color-bg);position:fixed;margin-left:10px;bottom:0px;z-index:50}.toggle-chat-button{background:none;border:none;padding-left:5px;padding-top:1rem;padding-right:1rem;padding-bottom:1.5rem;color:var(--color-fg);font-size:1rem;font-family:sans-serif}</style>",C(this,{target:this.shadowRoot},jt,yt,r,{theme:0,chat:1},[-1,-1]),t&&(t.target&&c(t.target,this,t.anchor),t.props&&(this.$set(t.props),G()))}static get observedAttributes(){return["theme","chat"]}get theme(){return this.$$.ctx[0]}set theme(t){this.$set({theme:t}),G()}get chat(){return this.$$.ctx[1]}set chat(t){this.$set({chat:t}),G()}}return customElements.define("scroll-chat",St),new St({target:document.body})}();
//# sourceMappingURL=bundle.js.map
